{% extends 'base.html' %} {% block content %}
<form action="/" id="login-form" method="POST" class="buttons">
  <h3>Login</h3>
  <div>
    <label>Email:</label>
    <input type="email" placeholder="Enter your email" name="email" />
  </div>
  <div>
    <label>Password:</label>
    <input type="password" placeholder="Enter your password" name="password" />
  </div>
  <button type="submit" name="login" class="create-btn">Login</button>
  <a href="{{ url_for('signup') }}" style="float: right">Create Account</a>
  <!-- Error Message -->
  <div id="error-message" style="color: red; margin-top: 10px"></div>
</form>

<script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-storage.js"></script>
<script src="static/firebase-init.js"></script>
<script>
  // Login
  const loginForm = document.querySelector("#login-form");
  const errorMessage = document.querySelector("#error-message");

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Get User Info
    const email = loginForm["email"].value;
    const password = loginForm["password"].value;

    try {
      // Login the User
      const cred = await auth.signInWithEmailAndPassword(email, password);
      loginForm.reset();
      const username = cred.user.username;
      localStorage.setItem("isLoggedIn", true); // Store login status as boolean
      window.location.replace("{{ url_for('home') }}");
    } catch (error) {
      console.log(error.message);
      errorMessage.textContent = "Invalid Credentials. Please try again.";
    }
  });
</script>
{% endblock %}
